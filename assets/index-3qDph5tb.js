(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();const b=document.querySelector(".popup_type_edit"),S=b.querySelector(".popup__form"),g=document.querySelector(".popup_type_new-card"),v=g.querySelector(".popup__form"),h=document.querySelector(".popup_type_image"),m=document.querySelector(".popup_type_edit-profile-image"),x=document.querySelector(".places__list"),P=document.querySelectorAll(".popup"),A=document.querySelector("#card-template").content.querySelector(".card"),a={addButton:document.querySelector(".profile__add-button"),editButton:document.querySelector(".profile__edit-button"),title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),image:document.querySelector(".profile__image"),popupEdit:b,editForm:S,editFormSaveButton:b.querySelector(".popup__button"),nameInput:S.querySelector(".popup__input_type_name"),jobInput:S.querySelector(".popup__input_type_description")},c={popup:m,form:m.querySelector(".popup__form"),formSaveButton:m.querySelector(".popup__button"),urlInput:m.querySelector(".popup__input_type_url_image")},s={popup:g,form:v,formSaveButton:g.querySelector(".popup__button"),nameInput:v.querySelector(".popup__input_type_card-name"),linkInput:v.querySelector(".popup__input_type_url")},_={popup:h,image:h.querySelector(".popup__image"),caption:h.querySelector(".popup__caption")},f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},k={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"86d5e46c-1713-458e-b702-e20fc258838f","Content-Type":"application/json"}};async function u(e,t){return fetch(`${k.baseUrl}${e}`,{...t,headers:k.headers}).then(o=>o.ok?o.json():Promise.reject(`Ошибка ${o.status}`))}const D=()=>u("/users/me",{method:"GET"}),F=e=>u("/users/me",{method:"PATCH",body:JSON.stringify(e)}),M=e=>u("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})}),O=()=>u("/cards",{method:"GET"}),$=e=>u("/cards",{method:"POST",body:JSON.stringify(e)}),N=e=>u(`/cards/${e}`,{method:"DELETE"}),U=e=>u(`/cards/likes/${e}`,{method:"DELETE"}),j=e=>u(`/cards/likes/${e}`,{method:"PUT"});function I(e,t){const o=e.querySelector(".card__like-button"),n=e.querySelector(".card__like-count"),r=L(t)?"add":"remove";n.textContent=t.length,o.classList[r]("card__like-button_is-active")}const L=e=>e.some(({_id:t})=>t===globalThis.userData._id);function V({data:e,openImage:t}){const o=A.cloneNode(!0),n=o.querySelector(".card__title"),r=o.querySelector(".card__image"),i=o.querySelector(".card__like-button");if(r.src=e.link,r.alt=e.name,n.textContent=e.name,I(o,e.likes),globalThis.userData._id===e.owner._id){const l=o.querySelector(".card__delete-button");l.classList.add("card__delete-button_visible"),l.addEventListener("click",()=>J(e._id,o))}return r.addEventListener("click",()=>t(r)),i.addEventListener("click",()=>G(e,o)),o}async function J(e,t){if(!confirm("Вы действительно хотите удалить карточку?")){console.warn(`Удаление карточки с id ${e} отменено.`);return}try{const{message:n}=await N(e);t.remove(),console.log(`%c${n}`,"color: green")}catch(n){console.error("Произошла ошибка при удалении карточки:",n)}}async function G(e,t){try{const{likes:o}=L(e.likes)?await U(e._id):await j(e._id);e.likes=o,I(t,o)}catch(o){console.error(`Произошла ошибка при ${L?"удалении лайка с":"лайке"} карточки:`,o)}}function B(e){if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}}function y(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",B)}function d(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",B)}const H=(e,t,o)=>{const n=e.nextElementSibling;e.classList.add(o.inputErrorClass),n.classList.add(o.errorClass),n.textContent=t},T=(e,t)=>{const o=e.nextElementSibling;e.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""},z=(e,t)=>{const{patternMismatch:o,valid:n}=e.validity,r=o?e.dataset.errorMessage:"";e.setCustomValidity(r),n?T(e,t):H(e,e.validationMessage,t)},q=(e,t,{inactiveButtonClass:o})=>{const n=e.some(({validity:{valid:i}})=>!i),r=n?"add":"remove";t.disabled=n,t.classList[r](o)},K=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);q(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{z(r,t),q(o,n,t)})})},Q=e=>{[...document.querySelectorAll(e.formSelector)].forEach(o=>{o.addEventListener("submit",n=>n.preventDefault()),K(o,e)})},C=(e,t)=>{const o=[...e.querySelectorAll(t.inputSelector)],n=e.querySelector(t.submitButtonSelector);o.forEach((r,i)=>{T(r,i),r.value=""}),q(o,n,t)};P.forEach(e=>{e.classList.add("popup_is-animated"),e.addEventListener("click",t=>{(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&d(e)})});function p(e,t){e.textContent=t?"Сохранение...":"Сохранить"}a.editButton.addEventListener("click",function(){C(a.editForm,f),a.nameInput.value=a.title.textContent,a.jobInput.value=a.description.textContent;const e=new InputEvent("input",{inputType:"insertText"});a.nameInput.dispatchEvent(e),a.jobInput.dispatchEvent(e),y(a.popupEdit)});async function R(e){e.preventDefault();try{p(a.editFormSaveButton,!0);const t=await F({name:a.nameInput.value,about:a.jobInput.value});E(t)}catch(t){console.error("Ошибка при редактировании профиля:",t)}finally{p(a.editFormSaveButton,!1),a.editForm.reset(),d(a.popupEdit)}}function E(e){globalThis.userData=e,a.title.textContent=e.name,a.description.textContent=e.about,a.image.style.backgroundImage=`url(${e.avatar})`}a.editForm.addEventListener("submit",R);a.image.addEventListener("click",function(){C(c.form,f),y(c.popup)});async function W(e){e.preventDefault();try{p(c.formSaveButton,!0);const t=await M(c.urlInput.value);E(t),d(c.popup),c.form.reset()}catch(t){console.error("Ошибка при редактировании аватара профиля:",t)}finally{p(c.formSaveButton,!1)}}c.form.addEventListener("submit",W);a.addButton.addEventListener("click",()=>y(s.popup));async function X(e){e.preventDefault();try{p(s.formSaveButton,!0);const t=await $({name:s.nameInput.value,link:s.linkInput.value});w(t,!1),d(s.popup),s.form.reset(),C(s.form,f)}catch(t){console.error("Ошибка при создании карточки:",t)}finally{p(s.formSaveButton,!1)}}s.form.addEventListener("submit",X);function Y(e){_.image.src=e.src,_.image.alt=e.alt,_.caption.textContent=e.alt,y(_.popup)}function w(e,t=!0){const o=V({data:e,openImage:Y});x[t?"append":"prepend"](o)}function Z(e){e.forEach(w)}Q(f);Promise.all([O(),D()]).then(([e,t])=>{E(t),Z(e)}).catch(console.error);
